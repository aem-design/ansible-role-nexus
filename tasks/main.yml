---
- name: set fact
  set_fact:
    role_comment: "( {{ docker_container_name | default('nexus') }} )"

- name: ensure image is present {{ role_comment }}
  include_role:
    name: docker-image
  tags:
    - docker-image

- name: ensure container is started {{ role_comment }}
  include_role:
    name: aem_design.docker_container
  vars:
    env:
      TZ: "{{ docker.timezone }}"
  tags:
    - docker-container

- name: update host network iptables {{ role_comment }}
  include_role:
    name: aem_design.config_iptables
  tags:
    - host-config

- name: wait until service is ready {{ role_comment }}
  uri:
    url: "http://{{ nexus_host }}:{{ nexus_port }}"
    return_content: true
    timeout: 300
  register: service_console
  until: service_console.content.find("Nexus Repository Manager") != -1
  delay: "{{ wait_delay | default(5) }}"
  retries: 360
